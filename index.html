<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Olympus Global Aether Network</title>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #ui { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        h1 { margin: 0; font-weight: 300; letter-spacing: 2px; color: #00d4ff; }
        .hint { font-size: 0.9em; opacity: 0.7; }
        #back-btn { 
            position: absolute; bottom: 20px; right: 20px; z-index: 100;
            padding: 10px 20px; background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff; color: white; cursor: pointer; display: none;
        }
        #back-btn:hover { background: #00d4ff; color: black; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>OLYMPUS AETHERIS-7</h1>
        <p class="hint">Global Atmospheric Mastery Network // 2026</p>
        <p id="status">Global Overview Mode</p>
    </div>
    <button id="back-btn" onclick="zoomOut()">Return to Globe</button>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const loader = new THREE.TextureLoader();

        const cities = [
            { name: "Shanghai", lat: 31.2323437, lon: 121.4691024, pos: new THREE.Vector3() },
            { name: "Beijing", lat: 39.9057136, lon: 116.3912972, pos: new THREE.Vector3() },
            { name: "Dhaka", lat: 23.7644025, lon: 90.389015, pos: new THREE.Vector3() },
            { name: "Chengdu", lat: 30.6598628, lon: 104.0633717, pos: new THREE.Vector3() },
            { name: "Delhi", lat: 28.6517178, lon: 77.2219388, pos: new THREE.Vector3() },
            { name: "Istanbul", lat: 41.0091982, lon: 28.9662187, pos: new THREE.Vector3() },
            { name: "Karachi", lat: 24.8546842, lon: 67.0207055, pos: new THREE.Vector3() },
            { name: "Guangzhou", lat: 23.1301964, lon: 113.2592945, pos: new THREE.Vector3() },
            { name: "Tianjin", lat: 39.084802, lon: 117.1959904, pos: new THREE.Vector3() },
            { name: "Tokyo", lat: 35.6812665, lon: 139.757653, pos: new THREE.Vector3() },
            { name: "Suzhou", lat: 31.3016935, lon: 120.5810725, pos: new THREE.Vector3() },
            { name: "Moscow", lat: 55.7504461, lon: 37.6174943, pos: new THREE.Vector3() },
            { name: "Shenzhen", lat: 22.5445741, lon: 114.0545429, pos: new THREE.Vector3() },
            { name: "Wuhan", lat: 30.5951051, lon: 114.2999353, pos: new THREE.Vector3() },
            { name: "Mumbai", lat: 19.0785451, lon: 72.878176, pos: new THREE.Vector3() },
            { name: "São Paulo", lat: -23.5506507, lon: -46.6333824, pos: new THREE.Vector3() },
            { name: "Lahore", lat: 31.5656822, lon: 74.3141829, pos: new THREE.Vector3() },
            { name: "Bengaluru", lat: 12.9767936, lon: 77.590082, pos: new THREE.Vector3() },
            { name: "Jakarta", lat: -6.175247, lon: 106.8270488, pos: new THREE.Vector3() },
            { name: "Lagos", lat: 6.4550575, lon: 3.3941795, pos: new THREE.Vector3() },
            { name: "Hangzhou", lat: 30.2489634, lon: 120.2052342, pos: new THREE.Vector3() },
            { name: "Chongqing", lat: 29.5656729, lon: 106.5479189, pos: new THREE.Vector3() },
            { name: "Shijiazhuang", lat: 38.0429742, lon: 114.5088385, pos: new THREE.Vector3() },
            { name: "Lima", lat: -12.0621065, lon: -77.0365256, pos: new THREE.Vector3() },
            { name: "Seoul", lat: 37.5666791, lon: 126.9782914, pos: new THREE.Vector3() },
            { name: "Foshan", lat: 23.0239788, lon: 113.1159558, pos: new THREE.Vector3() },
            { name: "Hefei", lat: 31.8228094, lon: 117.2218033, pos: new THREE.Vector3() },
            { name: "Nanjing", lat: 32.0615513, lon: 118.7915619, pos: new THREE.Vector3() },
            { name: "Wenzhou", lat: 27.9963899, lon: 120.695345, pos: new THREE.Vector3() },
            { name: "Weifang", lat: 36.7071591, lon: 119.1557441, pos: new THREE.Vector3() },
            { name: "Handan", lat: 36.583333, lon: 114.483333, pos: new THREE.Vector3() },
            { name: "Cairo", lat: 30.0443879, lon: 31.2357257, pos: new THREE.Vector3() },
            { name: "Changchun", lat: 43.8844201, lon: 125.3180998, pos: new THREE.Vector3() },
            { name: "Kinshasa", lat: -4.3217055, lon: 15.3125974, pos: new THREE.Vector3() },
            { name: "Zhoukou", lat: 33.6306299, lon: 114.6423617, pos: new THREE.Vector3() },
            { name: "London", lat: 51.5073359, lon: -0.12765, pos: new THREE.Vector3() },
            { name: "Xuzhou", lat: 34.2050708, lon: 117.2782967, pos: new THREE.Vector3() },
            { name: "New York", lat: 40.7127281, lon: -74.0060152, pos: new THREE.Vector3() },
            { name: "Heze", lat: 35.2477266, lon: 115.4464761, pos: new THREE.Vector3() },
            { name: "Nanning", lat: 22.8193063, lon: 108.3627211, pos: new THREE.Vector3() },
            { name: "Tehran", lat: 35.6892523, lon: 51.3896004, pos: new THREE.Vector3() },
            { name: "Xi'an", lat: 34.2607713, lon: 108.9423443, pos: new THREE.Vector3() },
            { name: "Mexico City", lat: 19.4326296, lon: -99.1331785, pos: new THREE.Vector3() },
            { name: "Fuzhou", lat: 26.0774954, lon: 119.2918215, pos: new THREE.Vector3() },
            { name: "Dongguan", lat: 23.0205969, lon: 113.7457788, pos: new THREE.Vector3() },
            { name: "Fuyang", lat: 32.8926763, lon: 115.8090001, pos: new THREE.Vector3() },
            { name: "Ho Chi Minh City", lat: 10.7763897, lon: 106.7011391, pos: new THREE.Vector3() },
            { name: "Bogota", lat: 4.6529539, lon: -74.0835643, pos: new THREE.Vector3() },
            { name: "Quanzhou", lat: 24.8755492, lon: 118.6723605, pos: new THREE.Vector3() },
            { name: "Hanoi", lat: 21.0283207, lon: 105.8540217, pos: new THREE.Vector3() },
            { name: "Shenyang", lat: 41.8026095, lon: 123.4279105, pos: new THREE.Vector3() },
            { name: "Nantong", lat: 31.9827896, lon: 120.8904588, pos: new THREE.Vector3() },
            { name: "Tangshan", lat: 39.6295951, lon: 118.1738712, pos: new THREE.Vector3() },
            { name: "Ningbo", lat: 29.8622194, lon: 121.6203873, pos: new THREE.Vector3() },
            { name: "Abidjan", lat: 5.320357, lon: -4.016107, pos: new THREE.Vector3() },
            { name: "Wuxi", lat: 31.4934662, lon: 120.307684, pos: new THREE.Vector3() },
            { name: "Hong Kong", lat: 22.2793278, lon: 114.1628131, pos: new THREE.Vector3() },
            { name: "Yancheng", lat: 33.349559, lon: 120.1577019, pos: new THREE.Vector3() },
            { name: "Yulin", lat: 22.6570263, lon: 110.1765019, pos: new THREE.Vector3() },
            { name: "Baghdad", lat: 33.3061701, lon: 44.3872213, pos: new THREE.Vector3() },
            { name: "Cangzhou", lat: 38.3042796, lon: 116.8511597, pos: new THREE.Vector3() },
            { name: "Jinan", lat: 36.6507007, lon: 117.1140042, pos: new THREE.Vector3() },
            { name: "Shaoyang", lat: 27.2426563, lon: 111.4610712, pos: new THREE.Vector3() },
            { name: "Surat", lat: 21.2094892, lon: 72.8317058, pos: new THREE.Vector3() },
            { name: "Bijie", lat: 27.2858633, lon: 105.2865997, pos: new THREE.Vector3() },
            { name: "Hyderabad", lat: 17.360589, lon: 78.4740613, pos: new THREE.Vector3() },
            { name: "Rio de Janeiro", lat: -22.9110137, lon: -43.2093727, pos: new THREE.Vector3() },
            { name: "Zunyi", lat: 27.7237996, lon: 106.9191408, pos: new THREE.Vector3() },
            { name: "Shangrao", lat: 28.4582821, lon: 117.9381305, pos: new THREE.Vector3() },
            { name: "Ahmedabad", lat: 23.0216238, lon: 72.5797068, pos: new THREE.Vector3() },
            { name: "Huanggang", lat: 30.4560187, lon: 114.8673226, pos: new THREE.Vector3() },
            { name: "Qingdao", lat: 36.0638034, lon: 120.3781372, pos: new THREE.Vector3() },
            { name: "Santiago", lat: -33.4377756, lon: -70.6504502, pos: new THREE.Vector3() },
            { name: "Prayagraj", lat: 25.4381302, lon: 81.8338005, pos: new THREE.Vector3() },
            { name: "Jieyang", lat: 23.553156, lon: 116.3680354, pos: new THREE.Vector3() },
            { name: "Qujing", lat: 25.490102, lon: 103.796167, pos: new THREE.Vector3() }
        ];

        let mode = 'globe'; // 'globe' or 'city'
        let currentCityName = '';
        const builtCities = new Set();
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // --- Globe Creation ---
        const globeGroup = new THREE.Group();
        const earthGeom = new THREE.SphereGeometry(5, 64, 64);
        const earthMat = new THREE.MeshPhongMaterial({
            map: loader.load('https://www.solarsystemscope.com/textures/download/2k_earth_daymap.jpg'),
            specularMap: loader.load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg'),
            bumpMap: loader.load('https://threejs.org/examples/textures/planets/earth_bump_2048.jpg'),
            bumpScale: 0.005,
            specular: new THREE.Color(0x333333),
            shininess: 25,
            emissive: 0x071426
        });
        const earth = new THREE.Mesh(earthGeom, earthMat);
        globeGroup.add(earth);

        // Clouds for weather model
        const cloudGeom = new THREE.SphereGeometry(5.05, 64, 64);
        const cloudMat = new THREE.MeshPhongMaterial({
            map: loader.load('https://www.solarsystemscope.com/textures/download/2k_earth_clouds.jpg'),
            transparent: true,
            opacity: 0.5
        });
        const clouds = new THREE.Mesh(cloudGeom, cloudMat);
        globeGroup.add(clouds);

        // Atmosphere Glow
        const atmosGeom = new THREE.SphereGeometry(5.2, 64, 64);
        const atmosMat = new THREE.MeshBasicMaterial({ color: 0x00d4ff, transparent: true, opacity: 0.1, side: THREE.BackSide });
        globeGroup.add(new THREE.Mesh(atmosGeom, atmosMat));

        // City Markers
        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);
            return new THREE.Vector3(
                -radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.cos(phi),
                radius * Math.sin(phi) * Math.sin(theta)
            );
        }

        function calculateIsDay(lon) {
            const date = new Date();
            const utcHour = date.getUTCHours() + (date.getUTCMinutes() / 60);
            let localHour = (utcHour + (lon / 15) + 24) % 24;
            return localHour >= 6 && localHour < 18;
        }

        const markers = [];
        cities.forEach(city => {
            const pos = latLonToVector3(city.lat, city.lon, 5);
            city.pos = pos;
            const markerGeom = new THREE.SphereGeometry(0.15, 16, 16);
            const markerMat = new THREE.MeshBasicMaterial({ color: 0x0000ff }); // All blue initially
            const marker = new THREE.Mesh(markerGeom, markerMat);
            marker.position.copy(pos);
            marker.userData = { cityName: city.name };
            globeGroup.add(marker);
            markers.push(marker);

            // Sun or Moon icon on globe
            const isDay = calculateIsDay(city.lon);
            const iconGeom = new THREE.SphereGeometry(0.1, 8, 8);
            const iconMat = new THREE.MeshBasicMaterial({ color: isDay ? 0xffff00 : 0xffffff });
            const icon = new THREE.Mesh(iconGeom, iconMat);
            const offset = pos.clone().normalize().multiplyScalar(0.3);
            icon.position.copy(pos).add(offset);
            globeGroup.add(icon);
        });

        scene.add(globeGroup);

        // --- Stars ---
        const starsGeometry = new THREE.BufferGeometry();
        const starsVertices = [];
        for (let i = 0; i < 10000; i++) {
            starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
            starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
            starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
        }
        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
        const starsMaterial = new THREE.PointsMaterial({ color: 0x888888, size: 0.1 });
        const starField = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(starField);

        // --- Moon ---
        const moonGeom = new THREE.SphereGeometry(0.5, 32, 32);
        const moonMat = new THREE.MeshPhongMaterial({ color: 0xdddddd });
        const moon = new THREE.Mesh(moonGeom, moonMat);
        moon.position.set(20, 0, 0);
        scene.add(moon);

        // --- City Scene Creation ---
        const cityGroup = new THREE.Group();
        cityGroup.visible = false;
        const weatherGroup = new THREE.Group();
        cityGroup.add(weatherGroup);
        
        // Procedural City Grid
        const buildCity = () => {
            const gridSize = 40;
            const spacing = 4;
            for(let x = -gridSize; x < gridSize; x += spacing) {
                for(let z = -gridSize; z < gridSize; z += spacing) {
                    // Buildings
                    const h = Math.random() * 10 + 2;
                    const bGeom = new THREE.BoxGeometry(2, h, 2);
                    const bMat = new THREE.MeshPhongMaterial({ color: 0x444444 });
                    const building = new THREE.Mesh(bGeom, bMat);
                    building.position.set(x, h/2, z);
                    cityGroup.add(building);

                    // Place Olympus Unit every 5 blocks (approx 20 units of distance)
                    if (Math.abs(x) % (spacing * 5) === 0 && Math.abs(z) % (spacing * 5) === 0) {
                        createAetherUnit(x + 2, z + 2);
                    }
                }
            }
            // Ground
            const gGeom = new THREE.PlaneGeometry(200, 200);
            const gMat = new THREE.MeshPhongMaterial({ color: 0x111111 });
            const ground = new THREE.Mesh(gGeom, gMat);
            ground.rotation.x = -Math.PI/2;
            cityGroup.add(ground);
        };

        function createAetherUnit(x, z) {
            const unitGroup = new THREE.Group();
            // The 7m Tower (Scale: 1 unit = 1 meter)
            const towerGeom = new THREE.CylinderGeometry(1, 1.25, 7, 32);
            const towerMat = new THREE.MeshPhongMaterial({ color: 0xffffff, emissive: 0x00d4ff, emissiveIntensity: 0.5 });
            const tower = new THREE.Mesh(towerGeom, towerMat);
            tower.position.y = 3.5;
            tower.name = 'aetherTower';
            unitGroup.add(tower);

            // Halo Effect
            const haloGeom = new THREE.RingGeometry(1.5, 1.7, 32);
            const haloMat = new THREE.MeshBasicMaterial({ color: 0x00d4ff, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
            const halo = new THREE.Mesh(haloGeom, haloMat);
            halo.rotation.x = Math.PI/2;
            halo.position.y = 7.1;
            unitGroup.add(halo);

            unitGroup.position.set(x, 0, z);
            cityGroup.add(unitGroup);
        }

        buildCity();
        scene.add(cityGroup);

        // --- Lighting ---
        const light = new THREE.PointLight(0xffffff, 100, 100);
        light.position.set(10, 10, 10);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        camera.position.z = 15;

        // --- Weather Effects Functions ---
        function createSunMoon(isDay) {
            const geom = new THREE.SphereGeometry(5, 32, 32);
            const mat = new THREE.MeshBasicMaterial({ color: isDay ? 0xffff00 : 0xdddddd });
            const mesh = new THREE.Mesh(geom, mat);
            mesh.position.set(0, 100, -100);
            return mesh;
        }

        function createRain(numParticles = 5000) {
            const positions = [];
            for (let i = 0; i < numParticles; i++) {
                positions.push(Math.random() * 200 - 100, Math.random() * 50 + 10, Math.random() * 200 - 100);
            }
            const geom = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            const mat = new THREE.PointsMaterial({ color: 0x8888ff, size: 0.1 });
            const points = new THREE.Points(geom, mat);
            points.userData = { type: 'rain' };
            return points;
        }

        function createSnow(numParticles = 5000) {
            const positions = [];
            for (let i = 0; i < numParticles; i++) {
                positions.push(Math.random() * 200 - 100, Math.random() * 50 + 10, Math.random() * 200 - 100);
            }
            const geom = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            const mat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.2 });
            const points = new THREE.Points(geom, mat);
            points.userData = { type: 'snow' };
            return points;
        }

        // --- Interaction ---
        window.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);

            if (mode === 'city') {
                const intersects = raycaster.intersectObjects(cityGroup.children, true);
                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj.name === 'aetherTower') {
                        const password = prompt('Enter password to build this unit:');
                        if (password === 'Aetheris') {
                            builtCities.add(currentCityName);
                            cityGroup.traverse(child => {
                                if (child.name === 'aetherTower') {
                                    child.material.color.set(0x00ff00);
                                    child.material.emissive.set(0x00ff00);
                                }
                            });
                            const marker = markers.find(m => m.userData.cityName === currentCityName);
                            if (marker) marker.material.color.set(0x00ff00);
                            alert('Unit built successfully!');
                        } else {
                            alert('Incorrect password.');
                        }
                    }
                }
            } else if (mode === 'globe') {
                const intersects = raycaster.intersectObjects(markers);
                if (intersects.length > 0) {
                    const cityName = intersects[0].object.userData.cityName;
                    const city = cities.find(c => c.name === cityName);
                    zoomToCity(cityName, city);
                }
            }
        });

        const weatherCodes = {
            0: 'Clear sky',
            1: 'Mainly clear',
            2: 'Partly cloudy',
            3: 'Overcast',
            45: 'Fog',
            48: 'Depositing rime fog',
            51: 'Light drizzle',
            53: 'Moderate drizzle',
            55: 'Dense drizzle',
            56: 'Light freezing drizzle',
            57: 'Dense freezing drizzle',
            61: 'Slight rain',
            63: 'Moderate rain',
            65: 'Heavy rain',
            66: 'Light freezing rain',
            67: 'Heavy freezing rain',
            71: 'Slight snow fall',
            73: 'Moderate snow fall',
            75: 'Heavy snow fall',
            77: 'Snow grains',
            80: 'Slight rain showers',
            81: 'Moderate rain showers',
            82: 'Violent rain showers',
            85: 'Slight snow showers',
            86: 'Heavy snow showers',
            95: 'Thunderstorm',
            96: 'Thunderstorm with slight hail',
            99: 'Thunderstorm with heavy hail'
        };

        function zoomToCity(name, city) {
            currentCityName = name;
            mode = 'city';
            document.getElementById('status').innerText = `Deployment View: ${name} - Fetching weather...`;
            document.getElementById('back-btn').style.display = 'block';
            
            // Set tower colors based on built status
            const isBuilt = builtCities.has(name);
            cityGroup.traverse(child => {
                if (child.name === 'aetherTower') {
                    if (isBuilt) {
                        child.material.color.set(0x00ff00);
                        child.material.emissive.set(0x00ff00);
                    } else {
                        child.material.color.set(0xffffff);
                        child.material.emissive.set(0x00d4ff);
                    }
                }
            });

            // Clear weather effects
            weatherGroup.children = [];
            scene.fog = null;

            // Fetch real-time weather
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true`)
                .then(response => response.json())
                .then(data => {
                    const weather = data.current_weather;
                    const condition = weatherCodes[weather.weathercode] || 'Unknown';
                    document.getElementById('status').innerText = `Deployment View: ${name} - Temp: ${weather.temperature}°C, Wind: ${weather.windspeed} km/h, Condition: ${condition}`;

                    // Add sun/moon
                    const isDay = weather.is_day;
                    const sunMoon = createSunMoon(isDay);
                    weatherGroup.add(sunMoon);

                    // Add weather effects
                    const lowerCondition = condition.toLowerCase();
                    if (lowerCondition.includes('fog')) {
                        scene.fog = new THREE.FogExp2(0xcccccc, 0.05);
                    } else if (lowerCondition.includes('cloud') || lowerCondition.includes('overcast')) {
                        scene.fog = new THREE.FogExp2(0xcccccc, 0.01);
                    }

                    if (lowerCondition.includes('rain') || lowerCondition.includes('drizzle') || lowerCondition.includes('shower') || lowerCondition.includes('thunderstorm')) {
                        const rain = createRain();
                        weatherGroup.add(rain);
                        scene.fog = new THREE.FogExp2(0xcccccc, 0.02);
                    } else if (lowerCondition.includes('snow')) {
                        const snow = createSnow();
                        weatherGroup.add(snow);
                        scene.fog = new THREE.FogExp2(0xcccccc, 0.02);
                    }
                })
                .catch(error => {
                    document.getElementById('status').innerText = `Deployment View: ${name} - Weather fetch failed`;
                });

            // Animation: Fade out globe, fade in city
            globeGroup.visible = false;
            cityGroup.visible = true;
            camera.position.set(0, 15, 30);
            camera.lookAt(0, 0, 0);
        }

        window.zoomOut = function() {
            mode = 'globe';
            document.getElementById('status').innerText = `Global Overview Mode`;
            document.getElementById('back-btn').style.display = 'none';
            cityGroup.visible = false;
            globeGroup.visible = true;
            scene.fog = null;
            weatherGroup.children = [];
            camera.position.set(0, 0, 15);
            camera.lookAt(0, 0, 0);
        }

        // --- Render Loop ---
        function animate() {
            requestAnimationFrame(animate);
            if (mode === 'globe') {
                globeGroup.rotation.y += 0.002;
                clouds.rotation.y += 0.0005; // Slow cloud rotation for dynamic weather feel
            } else {
                cityGroup.rotation.y += 0.001; // Slow city rotation for effect

                // Update weather particles
                weatherGroup.traverse(child => {
                    if (child.userData.type === 'rain') {
                        const pos = child.geometry.attributes.position;
                        for (let i = 0; i < pos.count; i++) {
                            pos.array[i * 3 + 1] -= 0.2;
                            if (pos.array[i * 3 + 1] < 0) pos.array[i * 3 + 1] = 50;
                        }
                        pos.needsUpdate = true;
                    } else if (child.userData.type === 'snow') {
                        const pos = child.geometry.attributes.position;
                        for (let i = 0; i < pos.count; i++) {
                            pos.array[i * 3 + 1] -= 0.05;
                            pos.array[i * 3] += Math.random() * 0.02 - 0.01;
                            pos.array[i * 3 + 2] += Math.random() * 0.02 - 0.01;
                            if (pos.array[i * 3 + 1] < 0) pos.array[i * 3 + 1] = 50;
                        }
                        pos.needsUpdate = true;
                    }
                });
            }
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
